<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Notenplaner - Behalte deine Leistungen im Blick">
  <title>Notenplaner - Campus Hugo</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="assets/sloth-icon.png">
  <style>
    .notenplaner-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    .notenplaner-title-group {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .notenplaner-icon {
      width: 3rem;
      height: 3rem;
      background: hsl(var(--primary) / 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .notenplaner-icon svg {
      width: 1.5rem;
      height: 1.5rem;
      color: hsl(var(--primary));
    }
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .stat-card {
      background: var(--card);
      border-radius: 0.75rem;
      padding: 1.25rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }
    .stat-card-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    .stat-icon {
      width: 2.5rem;
      height: 2.5rem;
      background: hsl(var(--primary) / 0.1);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .stat-icon svg {
      width: 1.25rem;
      height: 1.25rem;
      color: hsl(var(--primary));
    }
    .stat-label {
      font-size: 0.875rem;
      color: var(--muted-foreground);
    }
    .stat-value {
      font-size: 1.875rem;
      font-weight: 700;
    }
    .grade-great { color: var(--mood-great); }
    .grade-good { color: var(--mood-good); }
    .grade-neutral { color: var(--mood-neutral); }
    .grade-unwell { color: var(--mood-unwell); }
    .grade-bad { color: var(--mood-bad); }
    
    .semester-group {
      margin-bottom: 1.5rem;
    }
    .semester-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--muted);
      border-radius: 0.5rem;
      padding: 0.75rem 1rem;
      margin-bottom: 0.75rem;
    }
    .semester-title {
      font-weight: 700;
    }
    .semester-stats {
      display: flex;
      gap: 1rem;
      font-size: 0.875rem;
      color: var(--muted-foreground);
    }
    .grade-card {
      background: var(--card);
      border-radius: 0.75rem;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
      animation: fadeIn 0.3s ease-out;
    }
    .grade-card-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .grade-value {
      font-size: 1.5rem;
      font-weight: 700;
      width: 3.5rem;
      text-align: center;
    }
    .grade-info h3 {
      font-weight: 700;
      margin-bottom: 0.25rem;
    }
    .grade-info p {
      font-size: 0.875rem;
      color: var(--muted-foreground);
    }
    .grade-actions {
      display: flex;
      gap: 0.25rem;
    }
    .grade-actions button {
      background: transparent;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      color: var(--muted-foreground);
      border-radius: 0.375rem;
      transition: all 0.2s;
    }
    .grade-actions button:hover {
      background: var(--muted);
    }
    .grade-actions button.delete:hover {
      color: #ef4444;
    }
    .grade-actions button.edit:hover {
      color: hsl(var(--primary));
    }
    
    .empty-state {
      background: var(--card);
      border-radius: 0.75rem;
      padding: 3rem;
      text-align: center;
      border: 1px solid var(--border);
    }
    .empty-state svg {
      width: 3rem;
      height: 3rem;
      color: var(--muted-foreground);
      margin-bottom: 1rem;
    }
    .empty-state h3 {
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    .empty-state p {
      color: var(--muted-foreground);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    
    /* Dialog Form */
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    .form-group input {
      width: 100%;
      padding: 0.625rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      font-size: 1rem;
      background: var(--background);
    }
    .form-group input:focus {
      outline: none;
      border-color: hsl(var(--primary));
      box-shadow: 0 0 0 3px hsl(var(--primary) / 0.1);
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    .form-hint {
      font-size: 0.75rem;
      color: var(--muted-foreground);
      margin-top: 0.25rem;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <a href="dashboard.html" class="header-logo">
        <img src="assets/sloth-icon.png" alt="Logo">
        <div class="header-logo-text">
          <span class="header-logo-title">Campus Hugo</span>
        </div>
      </a>
      
      <button class="menu-btn" aria-label="Menü öffnen">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>
        </svg>
      </button>
    </div>
  </header>
  
  <!-- Menu Overlay -->
  <div class="menu-overlay"></div>
  <div class="menu-dropdown">
    <nav>
      <a href="dashboard.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        Home
      </a>
      <a href="forum.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
        Forum
      </a>
      <a href="berater.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Beratung
      </a>
      <a href="notenplaner.html" class="active">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>
        Notenplaner
      </a>
      <a href="artikel.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        Wissen
      </a>
      <a href="einstellungen.html">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        Dein Profil
      </a>
      <div class="menu-divider"></div>
      <a href="index.html" class="accent-link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
        Log Out
      </a>
    </nav>
  </div>

  <main class="page-container" style="padding-top: 1.5rem; padding-bottom: 2rem;">
    <!-- Header -->
    <div class="notenplaner-header">
      <div class="notenplaner-title-group">
        <div class="notenplaner-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="16" height="20" x="4" y="2" rx="2" ry="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>
        </div>
        <div>
          <h1>Notenplaner</h1>
          <p style="color: var(--muted-foreground);">Behalte deine Leistungen im Blick</p>
        </div>
      </div>
      <button class="btn btn-primary" id="add-grade-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        Neue Note
      </button>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
          </div>
          <span class="stat-label">Gesamtdurchschnitt</span>
        </div>
        <p class="stat-value" id="average-grade">–</p>
      </div>
      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-icon" style="background: hsl(var(--accent) / 0.1);">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
          </div>
          <span class="stat-label">Gesamt ECTS</span>
        </div>
        <p class="stat-value" id="total-ects">0</p>
      </div>
    </div>

    <!-- Grades List -->
    <div id="grades-list">
      <!-- Will be populated by JS -->
    </div>

    <!-- Empty State -->
    <div class="empty-state" id="empty-state" style="display: none;">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
      <h3>Noch keine Noten</h3>
      <p>Füge deine erste Note hinzu, um deinen Fortschritt zu tracken.</p>
      <button class="btn btn-primary" id="add-grade-btn-empty">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        Note hinzufügen
      </button>
    </div>
  </main>

  <!-- Add/Edit Grade Dialog -->
  <div class="dialog-overlay"></div>
  <div class="dialog" id="grade-dialog">
    <button class="dialog-close" aria-label="Schließen">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
    <div class="dialog-content">
      <h2 id="grade-dialog-title" style="margin-bottom: 1.5rem;">Neue Note hinzufügen</h2>
      
      <form id="grade-form">
        <div class="form-group">
          <label for="subject">Fach</label>
          <input type="text" id="subject" name="subject" placeholder="z.B. Mathematik I" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="grade">Note</label>
            <input type="number" id="grade" name="grade" step="0.1" min="1.0" max="5.0" placeholder="1.0 - 5.0" required>
          </div>
          <div class="form-group">
            <label for="credits">ECTS</label>
            <input type="number" id="credits" name="credits" min="1" placeholder="z.B. 6" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="semester">Semester *</label>
          <input type="text" id="semester" name="semester" placeholder="z.B. WS 2024/25" required>
          <p class="form-hint">Pflichtfeld</p>
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 0.5rem;" id="grade-submit-btn">
          Speichern
        </button>
      </form>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script>
    // Notenplaner specific functionality
    const GradeManager = {
      grades: [],
      editingId: null,
      
      init() {
        this.grades = JSON.parse(localStorage.getItem('grades') || '[]');
        this.render();
        this.bindEvents();
      },
      
      save() {
        localStorage.setItem('grades', JSON.stringify(this.grades));
        this.render();
      },
      
      getGradeColor(grade) {
        if (grade <= 1.5) return 'grade-great';
        if (grade <= 2.5) return 'grade-good';
        if (grade <= 3.5) return 'grade-neutral';
        if (grade <= 4.0) return 'grade-unwell';
        return 'grade-bad';
      },
      
      calculateAverage(gradeList = this.grades) {
        if (gradeList.length === 0) return 0;
        const totalCredits = gradeList.reduce((sum, g) => sum + g.credits, 0);
        const weightedSum = gradeList.reduce((sum, g) => sum + g.grade * g.credits, 0);
        return totalCredits > 0 ? (weightedSum / totalCredits).toFixed(2) : 0;
      },
      
      groupBySemester() {
        const groups = {};
        this.grades.forEach(grade => {
          const sem = grade.semester || 'Aktuell';
          if (!groups[sem]) groups[sem] = [];
          groups[sem].push(grade);
        });
        return groups;
      },
      
      sortSemesters(semesters) {
        return semesters.sort((a, b) => {
          const getSortValue = (s) => {
            const simpleNum = s.match(/(\d+)/);
            if (simpleNum && !s.match(/\d{4}/)) {
              return parseInt(simpleNum[1]) * 100;
            }
            const yearMatch = s.match(/(\d{4})/);
            if (yearMatch) {
              const year = parseInt(yearMatch[1]);
              const isWinter = s.toLowerCase().includes('ws');
              return year * 10 + (isWinter ? 1 : 0);
            }
            if (s.toLowerCase() === 'aktuell') return 999999;
            return 0;
          };
          return getSortValue(b) - getSortValue(a);
        });
      },
      
      render() {
        const listEl = document.getElementById('grades-list');
        const emptyEl = document.getElementById('empty-state');
        const avgEl = document.getElementById('average-grade');
        const ectsEl = document.getElementById('total-ects');
        
        // Update stats
        const avg = this.calculateAverage();
        avgEl.textContent = this.grades.length > 0 ? avg : '–';
        avgEl.className = 'stat-value ' + (this.grades.length > 0 ? this.getGradeColor(parseFloat(avg)) : '');
        
        const totalEcts = this.grades.reduce((sum, g) => sum + g.credits, 0);
        ectsEl.textContent = totalEcts;
        
        if (this.grades.length === 0) {
          listEl.innerHTML = '';
          emptyEl.style.display = '';
          return;
        }
        
        emptyEl.style.display = 'none';
        
        const grouped = this.groupBySemester();
        const sortedSemesters = this.sortSemesters(Object.keys(grouped));
        
        let html = '';
        sortedSemesters.forEach(semester => {
          const semGrades = grouped[semester];
          const semCredits = semGrades.reduce((sum, g) => sum + g.credits, 0);
          const semAvg = this.calculateAverage(semGrades);
          
          html += `
            <div class="semester-group">
              <div class="semester-header">
                <h2 class="semester-title">${semester}</h2>
                <div class="semester-stats">
                  <span>Ø <span class="${this.getGradeColor(parseFloat(semAvg))}" style="font-weight: 700;">${semAvg}</span></span>
                  <span><span style="font-weight: 700;">${semCredits}</span> ECTS</span>
                </div>
              </div>
              ${semGrades.map(grade => `
                <div class="grade-card" data-id="${grade.id}">
                  <div class="grade-card-left">
                    <div class="grade-value ${this.getGradeColor(grade.grade)}">${grade.grade.toFixed(1)}</div>
                    <div class="grade-info">
                      <h3>${grade.subject}</h3>
                      <p>${grade.credits} ECTS</p>
                    </div>
                  </div>
                  <div class="grade-actions">
                    <button class="edit" data-id="${grade.id}" title="Bearbeiten">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    </button>
                    <button class="delete" data-id="${grade.id}" title="Löschen">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        });
        
        listEl.innerHTML = html;
        
        // Bind edit/delete events
        listEl.querySelectorAll('.edit').forEach(btn => {
          btn.addEventListener('click', () => this.startEdit(btn.dataset.id));
        });
        listEl.querySelectorAll('.delete').forEach(btn => {
          btn.addEventListener('click', () => this.delete(btn.dataset.id));
        });
      },
      
      bindEvents() {
        document.getElementById('add-grade-btn').addEventListener('click', () => this.openDialog());
        document.getElementById('add-grade-btn-empty')?.addEventListener('click', () => this.openDialog());
        
        document.getElementById('grade-form').addEventListener('submit', (e) => {
          e.preventDefault();
          this.saveGrade();
        });
      },
      
      openDialog(editId = null) {
        this.editingId = editId;
        const form = document.getElementById('grade-form');
        const title = document.getElementById('grade-dialog-title');
        const submitBtn = document.getElementById('grade-submit-btn');
        
        if (editId) {
          const grade = this.grades.find(g => g.id === editId);
          if (grade) {
            form.subject.value = grade.subject;
            form.grade.value = grade.grade;
            form.credits.value = grade.credits;
            form.semester.value = grade.semester;
            title.textContent = 'Note bearbeiten';
            submitBtn.textContent = 'Aktualisieren';
          }
        } else {
          form.reset();
          title.textContent = 'Neue Note hinzufügen';
          submitBtn.textContent = 'Speichern';
        }
        
        openDialog('grade-dialog');
      },
      
      startEdit(id) {
        this.openDialog(id);
      },
      
      saveGrade() {
        const form = document.getElementById('grade-form');
        const subject = form.subject.value.trim();
        const grade = parseFloat(form.grade.value);
        const credits = parseInt(form.credits.value);
        const semester = form.semester.value.trim();
        
        if (!subject || !grade || !credits || !semester) {
          showToast('Bitte fülle alle Pflichtfelder aus');
          return;
        }
        
        if (this.editingId) {
          const idx = this.grades.findIndex(g => g.id === this.editingId);
          if (idx !== -1) {
            this.grades[idx] = { ...this.grades[idx], subject, grade, credits, semester };
            showToast(`${subject} wurde aktualisiert`);
          }
        } else {
          this.grades.push({
            id: Date.now().toString(),
            subject,
            grade,
            credits,
            semester
          });
          showToast(`${subject} wurde gespeichert`);
        }
        
        this.save();
        closeDialog('grade-dialog');
        this.editingId = null;
      },
      
      delete(id) {
        this.grades = this.grades.filter(g => g.id !== id);
        this.save();
        showToast('Note wurde entfernt');
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      GradeManager.init();
    });
  </script>
</body>
</html>
